#docker-machinery
version: 2

include:
    - depends/skeleton.yml

env_file:
    - depends/test.env

environment:
    - TEST=inmain

machines:
    test:
        extends:
            - .skeleton
            - .labelled
        prelude:
            -
                exec: mkdir
                args: -p /etc/test
                sudo: on
                remote: on
                copy: off
        files:
            -
                source: test/pwd/access.cfg
                destination: /etc/test/
                sudo: on
        images:
            - alpine
        ports:
            - 8080:80
            - 20514:514/udp
            - 9090
        environment:
            - TEST=overrideinvm
        compose:
            -
                environment:
                    - VERSION=1.15-alpine
                env_file:
                    - myvars.env
                files:
                    - docker-compose.yml
                project: test
